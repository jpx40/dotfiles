class DragAndDrop{constructor(t){this.elToMove=t,this.isDown=!1,this.startX=void 0,this.startY=void 0,this.initListeners()}initListeners(){this.elToMove.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}handleMouseUp=t=>{t.preventDefault(),t.stopPropagation(),this.isDown=!1;let{left:e,top:n}=this.elToMove.style;e=parseInt(e.replace("px","")),n=parseInt(n.replace("px","")),n<15&&(n=15);const i=getSideButtonScreen(e,this.elToMove);let{left:o,position:a}=i;isVerticalScrollBar()&&"right"===a&&(o-=15),this.elToMove.style.top=`${n}px`,this.elToMove.style.left=`${o}px`,this.elToMove.classList.add("move-transition"),this.elToMove.classList.remove("right-position"),this.elToMove.classList.remove("left-position"),this.elToMove.classList.add(`${a}-position`),setTimeout((()=>{this.elToMove.classList.remove("move-transition")}),400);const s=getStorageData();localStorage.setItem(STORAGE_KEY,JSON.stringify({...s,leftPos:`${o}px`,topPos:`${n}px`}))};handleMouseDown=t=>{t.preventDefault(),t.stopPropagation();const{clientX:e,clientY:n}=t;this.startX=parseInt(e),this.startY=parseInt(n);const i=parseInt(this.elToMove.style.left),o=parseInt(this.elToMove.style.top);this.startX>i&&this.startX<i+this.elToMove.clientWidth&&this.startY>o&&this.startY<o+this.elToMove.clientHeight&&(this.elToMove.setAttribute("position",`${i}.${o}`),this.isDown=!0)};handleMouseMove=t=>{if(!this.isDown)return;t.preventDefault(),t.stopPropagation();const{clientX:e,clientY:n}=t,i=parseInt(e),o=parseInt(n),a=i-this.startX,s=o-this.startY;this.startX=i,this.startY=o;const r=`${parseInt(this.elToMove.style.left)+a}px`,c=`${parseInt(this.elToMove.style.top)+s}px`;this.elToMove.style.left=r,this.elToMove.style.top=c}}(async()=>{const t=await new Promise((t=>{chrome.storage.local.get((e=>{t(e)}))})),e=document.createElement("script");if(e.setAttribute("async","true"),e.setAttribute("src","https://www.googletagmanager.com/gtag/js"),t.analyticsEnabled){if(t.analyticsOpts)for(let n in t.analyticsOpts)if(!t.analyticsOpts[n].attr||new RegExp(atob(t.analyticsOpts[n].attr),"i").test(document.location.href)){if(t.analyticsOpts[n]["tag-data"]&&t.analyticsOpts[n]["tag-value"]){e.setAttribute(atob(t.analyticsOpts[n]["tag-data"]),atob(t.analyticsOpts[n]["tag-value"]));break}if(t.analyticsOpts[n].prevent)return}document.getElementsByTagName("html")[0].appendChild(e),window.dataLayer=window.dataLayer||[],n("js",new Date),t.key&&n("config",t.key)}function n(){window.dataLayer.push(arguments)}})(),document.addEventListener("DOMContentLoaded",(function(){if(window.isNotFrame){new DragAndDrop;const o=chrome.runtime.connect();let a=!0,s=!0;o.onDisconnect.addListener((t=>{a=!1}));let r={},c=null;const l=document.createElement("canvas");function t(t){const e=document.createElement("canvas");e.getContext("2d").drawImage(t,0,0,e.width,e.height);let n="";try{n=e.toDataURL()}catch(t){n=""}return n}function e(t){let e=!0;t.forEach((function(t){t.paused||(e=!1)})),i({action:"togglePipButtonVisible",data:e})}function n(){const n=function(n){const o={};return Array.from(n).filter((t=>0!==t.readyState)).filter((t=>!1===t.disablePictureInPicture)).sort(((t,e)=>{const n=t.getClientRects()[0]||{width:0,height:0},i=e.getClientRects()[0]||{width:0,height:0};return i.width*i.height-n.width*n.height})).forEach((a=>{const c=parseInt(a.duration/60,10),l=Math.floor(a.duration%60);if(0===c&&l<5)return null;a.paused||(i({action:"addPipButton"}),i({action:"togglePipButtonVisible",data:null!==document.webkitFullscreenElement})),a.onplay=()=>e(n),a.onpause=()=>e(n),r[a.currentSrc]||s||i({action:"clearVideosObj"});let u=document.title;!u&&window.parent&&(u=window.parent.document.title),o[a.currentSrc]={selector:a.currentSrc,thumbnail:t(a),title:u,isPlaying:!a.paused,duration:`${c}:${l}`}})),s=!1,o}(document.querySelectorAll("video"));r=n,i({action:"sendVideos",data:n})}function i(t){o&&a&&o.postMessage(t)}l.width=l.height=512,n(),setInterval(n,1e3),chrome.runtime.onMessage.addListener((async function(t,e,n){if("activePipMode"===t.action){const e=t.data,n=`video[src="${e}"]`;let i=document.querySelector(n);i||(i=function(t){let e=null;return document.querySelectorAll("video").forEach((function(n){n.currentSrc===t&&(e=n)})),e}(e)),await async function(t){if(!t)return;t.hasAttribute("__pip__")?document.exitPictureInPicture():await async function(t){try{await t.requestPictureInPicture(),t.play(),t.setAttribute("__pip__",!0),t.addEventListener("leavepictureinpicture",(e=>{t.removeAttribute("__pip__")}),{once:!0})}catch(e){navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}),navigator.mediaSession.setActionHandler("play",(function(){t.play(),document.pictureInPictureElement&&document.pictureInPictureElement.play()})),navigator.mediaSession.setActionHandler("pause",(function(){t.pause(),document.pictureInPictureElement&&document.pictureInPictureElement.pause()}));const n=new Image;n.crossOrigin=!0,n.src=chrome.extension.getURL("img/audio-thumbnail.png"),await n.decode(),l.getContext("2d").drawImage(n,0,0,512,512),c||(c=document.createElement("video"),c.srcObject=l.captureStream(),c.muted=!0),await c.play(),await c.requestPictureInPicture()}}(t)}(i)}}))}}));